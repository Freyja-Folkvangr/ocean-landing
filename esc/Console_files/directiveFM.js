define(["language/common"],function(i18n){"use strict";function setAttr(scope,attr,val){try{eval(["scope."+attr,"=","val"].join(""))}catch(e){}}function getAttr(scope,attr){var data=null;try{data=scope.$eval(attr)}catch(e){}return data}function getDocBase(docLink){var protocolArr,protocol,location,hostArr,host;protocolArr=docLink&&docLink.split("//");protocol=protocolArr&&protocolArr[0]||"https:";location=protocolArr&&protocolArr[1]||"";hostArr=location.split("/");host=hostArr&&hostArr[0]||"";return protocol+"//"+host}function getBrowserInfo(ua){var browserInfo,chrome,firefox,ie;try{browserInfo={};chrome=ua.match(/Chrome\/([\d.]+)/)||ua.match(/CriOS\/([\d.]+)/);firefox=ua.match(/Firefox\/([\d.]+)/);ie=ua.match(/MSIE\s([\d.]+)/)||ua.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/);browserInfo.browser=chrome?"chrome":firefox?"firefox":"ie";browserInfo.version=chrome?chrome[1]:firefox?firefox[1]:ie[1];return browserInfo}catch(e){}}var mod=angular.module("directiveFM",["ng"]);mod.directive("fmLayout",function($state){var config={"restrict":"AE","template":"","link":function(scope,iElement,iAttrs){iElement.find(".tiny-layout-west").hide();setTimeout(function(){function activeCurrent(){var stateName,activeDiv,i;try{stateName=$state.current.name;activeDiv=[{"cur":"console.manager.rds","aim":"console.manager.rds.db"},{"cur":"taskCenter.left.productList","aim":"taskCenter.left.productSummary"},{"cur":"org.left.metering","aim":"org.left.metering.vdcDetailConfig"}];for(i=0;i<activeDiv.length;i++)if(stateName.indexOf(activeDiv[i].cur)>-1){stateName=activeDiv[i].aim;break}lay.opActive($(".tiny-layout-west a[ui-sref='"+stateName+"']").last())}catch(e){}}var lay=new window.tinyWidget.Layout({"id":iAttrs.id,"subheight":100});setAttr(scope,iAttrs.layout,lay);activeCurrent();scope.$on("$stateChangeSuccess",function(){$state.params&&$state.params.condition&&($state.params.condition=null);lay&&activeCurrent()});iElement.find(".tiny-layout-west").show()},1);scope.addScroll=function(){setTimeout(function(){var documentH=$(window).height(),leftTitle=$(".tiny-layout-title").height()+31,leftH=documentH-66-leftTitle;$("div.leftContH ul:first").height()>=leftH?$(".leftContH").css("height",leftH).addClass("layout-overClass"):$(".leftContH").css("height",leftH).removeClass("layout-overClass")},500)};var firstLoad=!0;scope.$on("$viewContentLoaded",function(){firstLoad&&scope.addScroll();firstLoad=!1});$(window).resize(function(){scope.addScroll()})}};return config});mod.directive("localLoading",function(){var config={"restrict":"EA","template":"<div></div>","link":function(scope,iElement,iAttrs){var height,width,display;$(iElement).parent().css("position","relative");$(iElement).parent().addClass("clearfix");iElement=$(iElement).find("div");$(iElement).addClass("local-loading");$(iElement).append("<div class='local-loading-gif'></div>");height=getAttr(scope,iAttrs.height)||"100%";width=getAttr(scope,iAttrs.width)||"100%";display=getAttr(scope,iAttrs.display);$(iElement).css("height",height);$(iElement).css("width",width);display||$(iElement).hide();scope.$watch(iAttrs.display,function(newValue){if(newValue){$(".local-loading").hide();$(iElement).show()}else $(iElement).hide()})}};return config});mod.directive("compileTemplate",["$compile","$parse",function($compile,$parse){return{"restrict":"A","link":function($scope,element,attr){function value(){return(parse($scope)||"").toString()}var parse=$parse(attr.ngBindHtml);$scope.$watch(value,function(){$compile(element,null,-9999)($scope)})}}}]);mod.filter("gteq0",function(){return function(value){try{return Math.max(value,0)}catch(e){return 0}}});mod.directive("popover",function(){var config={"restrict":"AE","template":"","link":function(scope,iElement,iAttrs){var options={"element":$(iElement),"position":iAttrs.popoverPlacement||"bottom-right","width":iAttrs.width||"300px","content":iAttrs.popover||""};new window.tinyWidget.Tip(options)}};return config});mod.directive("fmCrypto",function(){var config={"restrict":"A","template":"","link":function(scope,iElement){iElement.find("form").submit(function(){var form=$(this),act=form.attr("action"),o=asmCrypto.crypto(),prefix="";prefix=act.indexOf("?")>=0?"&verify-code=":"?verify-code=";form.attr("action",act+prefix+o.key+"&rand="+o.salt);setTimeout(function(){var arr=act.split(prefix);form.attr("action",arr[0])},0);return!0})}};return config});mod.directive("fmHelp",function(){var config={"restrict":"EA","template":"<a class='common-link'>"+i18n.common_term_learnMore_label+"</a>","link":function(scope,iElement,iAttrs){require(["app/business/help/configure"],function(configure){iElement.find("a").click(function(){var local="en-us"==window.urlParams.lang?"en":"zh",url=configure.getHelp(getAttr(scope,iAttrs.help),"ICT",local);window.open(url);window.opener=null})})}};return config});mod.directive("helpCenter",function(){var config={"restrict":"EA","template":"<a class='common-link'>"+i18n.common_term_learnMore_label+"</a>","link":function(scope,iElement,iAttrs){require(["app/business/help/helpCenterConfig"],function(configure){iElement.find("a").click(function(){var scope=$("html").injector().get("$rootScope"),local=window.urlParams.lang,docPath=configure.getHelp(getAttr(scope,iAttrs.help),local),docLink=scope.links&&(scope.links["document_center_zh-cn"]||scope.links["document_center_en-us"]),url=getDocBase(docLink)+"/"+local+docPath;window.open(url);window.opener=null})})}};return config});window.asmCrypto={};window.asmCrypto.crypto=function(string){var d=new Date,storage=($("html").scope(),$("html").injector().get("storage")),key=storage.cookieStorage.getItem("cftk")?CryptoJS.HmacSHA256(storage.cookieStorage.getItem("cftk"),""+d.valueOf()).toString():"";return string?"verify-code="+key+"&rand="+d.valueOf():{"key":key,"salt":d.valueOf()}};window.htmlDecode={};window.htmlDecode.done=function(text){if(!text)return text;return text.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&#92;/g,"\\").replace(/&apos;/g,"'").replace(/&amp;/g,"&").replace(/&#40;/g,"(").replace(/&#41;/g,")")};window.closeRowDetails={};window.closeRowDetails.done=function(tableIdDom){$("#"+tableIdDom+" tbody tr").each(function(i,domStr){var classAry,classStr=$(domStr).find(".btn_detail_switch");if(0===classStr.length)return;classAry=classStr.attr("class").split(" ");"default_hide_style"===classAry[1]&&$(domStr).find(".btn_detail_switch").click()})};window.addTdTitle={};window.addTdTitle.done=function(tableIdDom,index){$("#"+tableIdDom+" tbody tr").each(function(i,item){$(item).children("td[tdname='"+index+"']").addTitle()})};window.browserInfo=getBrowserInfo(navigator.userAgent);return mod});